# ğŸ“œ è„šæœ¬ä½¿ç”¨æŒ‡å—

æœ¬é¡¹ç›®æä¾›äº†ä¸°å¯Œçš„ç®¡ç†è„šæœ¬ï¼Œè®©æœåŠ¡ç®¡ç†å˜å¾—ç®€å•é«˜æ•ˆã€‚

## ğŸ“‹ è„šæœ¬åˆ—è¡¨

### ğŸš€ éƒ¨ç½²è„šæœ¬

| è„šæœ¬ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `deploy.sh` | è‡ªåŠ¨éƒ¨ç½²ï¼ˆPython 3ï¼‰ | å…¨è‡ªåŠ¨å®‰è£…å’Œé…ç½® |
| `fix_service_py2.sh` | ä¿®å¤éƒ¨ç½²ï¼ˆPython 2ï¼‰ | Python 2 ä¸“ç”¨ä¿®å¤è„šæœ¬ |
| `start.sh` | å¼€å‘æ¨¡å¼å¯åŠ¨ | æœ¬åœ°å¼€å‘æµ‹è¯•ç”¨ |

### ğŸ›ï¸ æœåŠ¡ç®¡ç†è„šæœ¬

| è„šæœ¬ | ç”¨é€” | å‘½ä»¤ |
|------|------|------|
| `start_service.sh` | å¯åŠ¨æœåŠ¡ | `./start_service.sh` |
| `stop.sh` | åœæ­¢æœåŠ¡ | `./stop.sh` |
| `restart_service.sh` | é‡å¯æœåŠ¡ | `./restart_service.sh` |
| `status.sh` | æŸ¥çœ‹çŠ¶æ€ | `./status.sh` |
| `logs.sh` | æŸ¥çœ‹æ—¥å¿— | `./logs.sh` |
| `manage.sh` | ç»¼åˆç®¡ç†å·¥å…· | `./manage.sh` |

### ğŸ”§ è¯Šæ–­è„šæœ¬

| è„šæœ¬ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `diagnose.sh` | æ•…éšœè¯Šæ–­ | è‡ªåŠ¨æ£€æµ‹é—®é¢˜ |
| `fix_service.sh` | ä¿®å¤æœåŠ¡ | é€šç”¨ä¿®å¤è„šæœ¬ |

---

## ğŸ¯ å¸¸ç”¨åœºæ™¯

### åœºæ™¯ 1: é¦–æ¬¡éƒ¨ç½²

```bash
# 1. ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x *.sh

# 2. è¿è¡Œéƒ¨ç½²è„šæœ¬
# Python 2 ç”¨æˆ·
./fix_service_py2.sh

# æˆ– Python 3 ç”¨æˆ·
sudo ./deploy.sh

# 3. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./status.sh
```

### åœºæ™¯ 2: æ—¥å¸¸ç®¡ç†

**ä½¿ç”¨ç»¼åˆç®¡ç†å·¥å…·ï¼ˆæ¨èï¼‰**ï¼š

```bash
./manage.sh
```

è¿›å…¥äº¤äº’å¼èœå•ï¼Œé€‰æ‹©ç›¸åº”æ“ä½œã€‚

**ä½¿ç”¨ç‹¬ç«‹è„šæœ¬**ï¼š

```bash
# å¯åŠ¨æœåŠ¡
./start_service.sh

# åœæ­¢æœåŠ¡
./stop.sh

# é‡å¯æœåŠ¡
./restart_service.sh

# æŸ¥çœ‹çŠ¶æ€
./status.sh

# æŸ¥çœ‹æ—¥å¿—
./logs.sh
```

### åœºæ™¯ 3: æ•…éšœæ’æŸ¥

```bash
# 1. æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
./status.sh

# 2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
./logs.sh
# é€‰æ‹© 6) é”™è¯¯æ—¥å¿—

# 3. è¿è¡Œè¯Šæ–­
./diagnose.sh

# 4. å°è¯•ä¿®å¤
./fix_service_py2.sh  # Python 2
# æˆ–
./fix_service.sh      # Python 3
```

### åœºæ™¯ 4: æ›´æ–°ä»£ç 

```bash
# 1. åœæ­¢æœåŠ¡
./stop.sh

# 2. æ›´æ–°ä»£ç ï¼ˆgit pull æˆ–ä¸Šä¼ æ–°æ–‡ä»¶ï¼‰

# 3. é‡å¯æœåŠ¡
./start_service.sh

# 4. æŸ¥çœ‹çŠ¶æ€
./status.sh
```

### åœºæ™¯ 5: æŸ¥çœ‹æ—¥å¿—

```bash
# æ–¹æ³• 1: ä½¿ç”¨æ—¥å¿—è„šæœ¬ï¼ˆæ¨èï¼‰
./logs.sh

# æ–¹æ³• 2: ç›´æ¥ä½¿ç”¨ systemctl å‘½ä»¤
sudo journalctl -u photo-gallery -f
```

---

## ğŸ“– è„šæœ¬è¯¦è§£

### 1. stop.sh - åœæ­¢æœåŠ¡

**åŠŸèƒ½**ï¼š
- åœæ­¢ photo-gallery æœåŠ¡
- æ£€æŸ¥æœåŠ¡çŠ¶æ€
- æ˜¾ç¤ºæ“ä½œç»“æœ

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
./stop.sh
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
================================
  åœæ­¢ç”µå­ç›¸å†ŒæœåŠ¡
================================

å½“å‰æœåŠ¡çŠ¶æ€:
â— photo-gallery.service - Photo Gallery Web Application
   Loaded: loaded
   Active: active (running)

æ­£åœ¨åœæ­¢æœåŠ¡...
âœ“ æœåŠ¡å·²æˆåŠŸåœæ­¢

æœåŠ¡çŠ¶æ€:
â— photo-gallery.service - Photo Gallery Web Application
   Active: inactive (dead)

å¦‚éœ€é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œè¯·è¿è¡Œ:
  sudo systemctl start photo-gallery
  æˆ–è¿è¡Œ: ./start_service.sh
```

### 2. start_service.sh - å¯åŠ¨æœåŠ¡

**åŠŸèƒ½**ï¼š
- å¯åŠ¨ photo-gallery æœåŠ¡
- å¦‚æœæœåŠ¡å·²è¿è¡Œï¼Œæç¤ºæ˜¯å¦é‡å¯
- æ˜¾ç¤ºè®¿é—®åœ°å€

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
./start_service.sh
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
================================
  å¯åŠ¨ç”µå­ç›¸å†ŒæœåŠ¡
================================

æ­£åœ¨å¯åŠ¨æœåŠ¡...
âœ“ æœåŠ¡å¯åŠ¨æˆåŠŸ

æœåŠ¡çŠ¶æ€:
â— photo-gallery.service - Photo Gallery Web Application
   Active: active (running)

åº”ç”¨å·²æˆåŠŸè¿è¡Œï¼

è®¿é—®åœ°å€:
  http://localhost:5000
  http://192.168.1.100:5000

æŸ¥çœ‹æ—¥å¿—: sudo journalctl -u photo-gallery -f
```

### 3. restart_service.sh - é‡å¯æœåŠ¡

**åŠŸèƒ½**ï¼š
- é‡å¯ photo-gallery æœåŠ¡
- ç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆ
- æ˜¾ç¤ºè®¿é—®åœ°å€

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
./restart_service.sh
```

**é€‚ç”¨åœºæ™¯**ï¼š
- ä¿®æ”¹é…ç½®å
- æ›´æ–°ä»£ç å
- æœåŠ¡å¼‚å¸¸æ—¶
- å®šæœŸç»´æŠ¤

### 4. status.sh - æŸ¥çœ‹çŠ¶æ€

**åŠŸèƒ½**ï¼š
- æœåŠ¡è¿è¡ŒçŠ¶æ€
- ç«¯å£ç›‘å¬æƒ…å†µ
- è¿›ç¨‹ä¿¡æ¯
- æœ€è¿‘æ—¥å¿—
- ç…§ç‰‡ç»Ÿè®¡
- æœåŠ¡å™¨ä¿¡æ¯
- ç³»ç»Ÿèµ„æº

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
./status.sh
```

**è¾“å‡ºåŒ…æ‹¬**ï¼š
```
1. æœåŠ¡çŠ¶æ€ (active/inactive)
2. ç«¯å£ç›‘å¬ (5000)
3. è¿›ç¨‹ä¿¡æ¯ (gunicorn)
4. æœ€è¿‘æ—¥å¿— (20 è¡Œ)
5. ç…§ç‰‡å­˜å‚¨ (æ•°é‡ã€å¤§å°)
6. æœåŠ¡å™¨ä¿¡æ¯ (IPã€è®¿é—®åœ°å€)
7. ç³»ç»Ÿèµ„æº (å†…å­˜ã€ç£ç›˜)
```

### 5. logs.sh - æŸ¥çœ‹æ—¥å¿—

**åŠŸèƒ½**ï¼š
- å®æ—¶æ—¥å¿—æŸ¥çœ‹
- å†å²æ—¥å¿—æŸ¥çœ‹
- é”™è¯¯æ—¥å¿—è¿‡æ»¤
- æŒ‰æ—¶é—´ç­›é€‰

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
./logs.sh
```

**èœå•é€‰é¡¹**ï¼š
```
1) å®æ—¶æ—¥å¿—ï¼ˆæŒ‰ Ctrl+C é€€å‡ºï¼‰
2) æœ€è¿‘ 50 è¡Œæ—¥å¿—
3) æœ€è¿‘ 100 è¡Œæ—¥å¿—
4) æœ€è¿‘ 200 è¡Œæ—¥å¿—
5) ä»Šå¤©çš„æ—¥å¿—
6) é”™è¯¯æ—¥å¿—
7) æ‰€æœ‰æ—¥å¿—
```

### 6. manage.sh - ç»¼åˆç®¡ç†å·¥å…·

**åŠŸèƒ½**ï¼š
- äº¤äº’å¼èœå•
- ä¸€ç«™å¼ç®¡ç†
- æœåŠ¡æ§åˆ¶
- æ•°æ®å¤‡ä»½

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
./manage.sh
```

**èœå•ç•Œé¢**ï¼š
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     ç”µå­ç›¸å†Œ - æœåŠ¡ç®¡ç†å·¥å…·           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æœåŠ¡çŠ¶æ€: â— è¿è¡Œä¸­

è¯·é€‰æ‹©æ“ä½œ:

1) å¯åŠ¨æœåŠ¡
2) åœæ­¢æœåŠ¡
3) é‡å¯æœåŠ¡
4) æŸ¥çœ‹çŠ¶æ€
5) æŸ¥çœ‹æ—¥å¿—

6) æŸ¥çœ‹ç…§ç‰‡ç»Ÿè®¡
7) å¤‡ä»½æ•°æ®

0) é€€å‡º

è¯·è¾“å…¥é€‰é¡¹ (0-7):
```

---

## ğŸ” æƒé™è¯´æ˜

### éœ€è¦ sudo æƒé™çš„è„šæœ¬

- `deploy.sh` - å®‰è£…ç³»ç»Ÿä¾èµ–
- `fix_service_py2.sh` - é…ç½®ç³»ç»ŸæœåŠ¡
- æ‰€æœ‰æœåŠ¡ç®¡ç†è„šæœ¬ - æ“ä½œ systemd æœåŠ¡

### ä¸éœ€è¦ sudo çš„è„šæœ¬

- `start.sh` - å¼€å‘æ¨¡å¼å¯åŠ¨
- `diagnose.sh` - è¯Šæ–­ï¼ˆéƒ¨åˆ†åŠŸèƒ½éœ€è¦ sudoï¼‰

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. ç»™æ‰€æœ‰è„šæœ¬æ‰§è¡Œæƒé™

```bash
chmod +x *.sh
```

### 2. åˆ›å»ºåˆ«åï¼ˆå¯é€‰ï¼‰

åœ¨ `~/.bashrc` ä¸­æ·»åŠ ï¼š

```bash
alias pg-start='cd /path/to/photo-gallery && ./start_service.sh'
alias pg-stop='cd /path/to/photo-gallery && ./stop.sh'
alias pg-restart='cd /path/to/photo-gallery && ./restart_service.sh'
alias pg-status='cd /path/to/photo-gallery && ./status.sh'
alias pg-logs='cd /path/to/photo-gallery && ./logs.sh'
alias pg-manage='cd /path/to/photo-gallery && ./manage.sh'
```

ç„¶åæ‰§è¡Œï¼š
```bash
source ~/.bashrc
```

ä¹‹åå¯ä»¥åœ¨ä»»ä½•ç›®å½•ä½¿ç”¨ï¼š
```bash
pg-start    # å¯åŠ¨æœåŠ¡
pg-stop     # åœæ­¢æœåŠ¡
pg-status   # æŸ¥çœ‹çŠ¶æ€
pg-manage   # ç®¡ç†å·¥å…·
```

### 3. å®šæ—¶ä»»åŠ¡

**è‡ªåŠ¨é‡å¯ï¼ˆæ¯å¤©å‡Œæ™¨ 3 ç‚¹ï¼‰**ï¼š

```bash
crontab -e
```

æ·»åŠ ï¼š
```
0 3 * * * cd /path/to/photo-gallery && ./restart_service.sh > /dev/null 2>&1
```

**è‡ªåŠ¨å¤‡ä»½ï¼ˆæ¯å‘¨ä¸€å‡Œæ™¨ 2 ç‚¹ï¼‰**ï¼š

```
0 2 * * 1 cd /path/to/photo-gallery && tar -czf backup-$(date +\%Y\%m\%d).tar.gz uploads/ metadata.json
```

### 4. ç›‘æ§æœåŠ¡çŠ¶æ€

åˆ›å»ºç›‘æ§è„šæœ¬ `monitor.sh`ï¼š

```bash
#!/bin/bash
while true; do
    if ! systemctl is-active --quiet photo-gallery; then
        echo "æœåŠ¡å·²åœæ­¢ï¼Œæ­£åœ¨é‡å¯..."
        systemctl start photo-gallery
        echo "é‡å¯å®Œæˆ: $(date)"
    fi
    sleep 60
done
```

### 5. å¿«é€Ÿæ•…éšœæ¢å¤

```bash
# ä¸€é”®ä¿®å¤è„šæœ¬
./stop.sh && \
./fix_service_py2.sh && \
./start_service.sh && \
./status.sh
```

---

## ğŸ”„ è„šæœ¬æ›´æ–°

å½“é¡¹ç›®æ›´æ–°æ—¶ï¼Œé‡æ–°ä¸‹è½½è„šæœ¬ï¼š

```bash
# å¤‡ä»½å½“å‰è„šæœ¬
mkdir backup_scripts
cp *.sh backup_scripts/

# ä¸‹è½½æ–°è„šæœ¬
# ... ä¸Šä¼ æ–°æ–‡ä»¶ ...

# ç»™æƒé™
chmod +x *.sh
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: è„šæœ¬æç¤º"æƒé™è¢«æ‹’ç»"

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
chmod +x script_name.sh
```

### Q2: è„šæœ¬æ‰¾ä¸åˆ°æœåŠ¡

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å…ˆè¿è¡Œéƒ¨ç½²è„šæœ¬
./fix_service_py2.sh  # Python 2
# æˆ–
sudo ./deploy.sh      # Python 3
```

### Q3: sudo å¯†ç è¾“å…¥é¢‘ç¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ·»åŠ  sudo é…ç½®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ï¼š
```bash
sudo visudo
```

æ·»åŠ ï¼š
```
your_username ALL=(ALL) NOPASSWD: /bin/systemctl * photo-gallery*
```

### Q4: è„šæœ¬æ‰§è¡ŒæŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
bash -x ./script_name.sh

# æˆ–
sh -x ./script_name.sh
```

---

## ğŸ“ è„šæœ¬ç»´æŠ¤

### è‡ªå®šä¹‰è„šæœ¬

å¯ä»¥åŸºäºç°æœ‰è„šæœ¬åˆ›å»ºè‡ªå®šä¹‰ç‰ˆæœ¬ï¼š

```bash
# å¤åˆ¶è„šæœ¬
cp manage.sh my_manage.sh

# ç¼–è¾‘
nano my_manage.sh

# ç»™æƒé™
chmod +x my_manage.sh
```

### è´¡çŒ®è„šæœ¬

å¦‚æœä½ åˆ›å»ºäº†æœ‰ç”¨çš„è„šæœ¬ï¼Œæ¬¢è¿åˆ†äº«ï¼

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **å®šæœŸå¤‡ä»½**ï¼šä½¿ç”¨ `manage.sh` çš„å¤‡ä»½åŠŸèƒ½
2. **æŸ¥çœ‹æ—¥å¿—**ï¼šå‡ºé—®é¢˜å…ˆçœ‹æ—¥å¿—
3. **å®šæœŸé‡å¯**ï¼šé¿å…å†…å­˜æ³„æ¼
4. **ç›‘æ§çŠ¶æ€**ï¼šä½¿ç”¨ `status.sh` äº†è§£ç³»ç»ŸçŠ¶æ€
5. **æ›´æ–°åŠæ—¶**ï¼šä»£ç æ›´æ–°åè®°å¾—é‡å¯æœåŠ¡

---

## ğŸ“ è·å–å¸®åŠ©

è„šæœ¬å‡ºç°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹è„šæœ¬è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
2. è¿è¡Œ `./diagnose.sh` è¯Šæ–­
3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿— `./logs.sh`
4. é˜…è¯» [QUICK_FIX.md](QUICK_FIX.md)

---

**è®©æœåŠ¡ç®¡ç†å˜å¾—ç®€å•ï¼** ğŸš€

