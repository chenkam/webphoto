# 更新日志

## 2025-12-26 - 账号认证功能

### 新增功能

#### 1. 账号管理系统
- ✅ 添加账号配置文件 `accounts.json`
- ✅ 支持多账号管理
- ✅ 默认账号：用户名 `cecilia`，密码 `20210427`

#### 2. 用户认证
- ✅ 用户登录功能 (`/api/login`)
- ✅ 用户登出功能 (`/api/logout`)
- ✅ 登录状态检查 (`/api/check_auth`)
- ✅ Flask Session会话管理
- ✅ 登录状态持久化

#### 3. 权限控制
- ✅ 上传照片需要登录
  - 未登录时显示"需要登录"提示
  - 登录后显示上传表单
- ✅ 删除照片需要登录
  - 未登录时隐藏删除按钮
  - 登录后显示删除按钮

#### 4. UI改进
- ✅ 导航栏添加登录按钮
- ✅ 登录后显示用户名
- ✅ 登录后显示登出按钮
- ✅ 新增登录页面
- ✅ 上传页面添加未登录提示

#### 5. 前端功能
- ✅ 页面加载时自动检查登录状态
- ✅ 根据登录状态动态更新UI
- ✅ 登录/登出无需刷新页面
- ✅ 表单验证和错误提示

### 修改的文件

#### 后端
- `app.py`
  - 添加 `session` 支持
  - 添加 `ACCOUNTS_FILE` 配置
  - 添加 `load_accounts()` 函数
  - 添加 `check_auth()` 函数
  - 添加 `is_logged_in()` 函数
  - 添加 `/api/login` 路由
  - 添加 `/api/logout` 路由
  - 添加 `/api/check_auth` 路由
  - 修改 `/api/upload` 添加登录验证
  - 修改 `/api/photos/<id>` 添加登录验证

#### 前端
- `templates/index.html`
  - 导航栏添加登录/用户名/登出按钮
  - 上传页面添加未登录提示区域
  - 新增登录页面 (`loginPage`)
  - 删除按钮默认隐藏（登录后显示）

- `static/script.js`
  - 添加全局变量 `isLoggedIn` 和 `currentUser`
  - 添加 `checkAuthStatus()` 函数
  - 添加 `updateUIForLoggedIn()` 函数
  - 添加 `updateUIForLoggedOut()` 函数
  - 添加 `updateUploadPageAuth()` 函数
  - 添加 `setupLogin()` 函数
  - 添加 `handleLogin()` 函数
  - 添加 `handleLogout()` 函数
  - 修改 `switchPage()` 支持登录页面
  - 修改 `init()` 添加登录初始化

#### 新增文件
- `accounts.json` - 账号配置文件
- `test_auth.py` - 认证功能测试脚本
- `USER_GUIDE.md` - 用户使用指南
- `QUICKSTART.md` - 快速启动指南

### 技术特点

1. **安全性**
   - 服务器端验证所有敏感操作
   - Session安全管理
   - 密码明文存储在配置文件（可根据需求改为哈希）

2. **用户体验**
   - 登录状态持久化
   - 无刷新页面状态切换
   - 实时权限控制
   - 友好的错误提示

3. **可维护性**
   - 账号配置文件化
   - 清晰的权限控制逻辑
   - 完善的日志记录

### 使用说明

#### 默认账号
- 用户名：`cecilia`
- 密码：`20210427`

#### 启动应用
```bash
python app.py
```

#### 访问地址
```
http://localhost:5000
```

#### 权限说明

| 功能 | 未登录 | 已登录 |
|------|:------:|:------:|
| 浏览相册 | ✅ | ✅ |
| 上传照片 | ❌ | ✅ |
| 删除照片 | ❌ | ✅ |

### 测试

运行测试脚本：
```bash
python test_auth.py
```

测试结果：✅ 所有测试通过

### 已知问题

无

### 未来计划

- [ ] 密码哈希加密
- [ ] 记住登录状态（Remember Me）
- [ ] 用户注册功能
- [ ] 密码重置功能
- [ ] 多角色权限管理
- [ ] 操作日志记录

---

## 之前版本

### 初始版本
- ✅ 3D全屏相册展示
- ✅ 照片上传功能
- ✅ 照片删除功能
- ✅ 自动播放功能
- ✅ 键盘/鼠标/触摸控制
- ✅ 拖拽上传
- ✅ 响应式设计
