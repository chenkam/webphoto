<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é¡µé¢</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='themes.css') }}">
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        h1 { color: #4ecdc4; }
        .test-section {
            background: #16213e;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #4ecdc4;
        }
        .test-section h3 { color: #4ecdc4; margin-top: 0; }
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
        .warning { color: #f39c12; }
        pre {
            background: #0f0f1a;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        button {
            background: #4ecdc4;
            color: #1a1a2e;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        button:hover { background: #3db3aa; }
        img.test-img {
            max-width: 200px;
            max-height: 200px;
            border: 2px solid #4ecdc4;
            margin: 5px;
        }
        #photoGrid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Photo Gallery è°ƒè¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h3>1. æµ‹è¯• API è¿æ¥</h3>
        <button onclick="testAPI()">æµ‹è¯• /api/photos</button>
        <pre id="apiResult">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</pre>
    </div>
    
    <div class="test-section">
        <h3>2. ç…§ç‰‡åˆ—è¡¨</h3>
        <button onclick="loadPhotoList()">åŠ è½½ç…§ç‰‡åˆ—è¡¨</button>
        <pre id="photoList">ç‚¹å‡»æŒ‰é’®åŠ è½½...</pre>
    </div>
    
    <div class="test-section">
        <h3>3. å›¾ç‰‡åŠ è½½æµ‹è¯•</h3>
        <p>å¦‚æœä¸Šé¢æœ‰ç…§ç‰‡ï¼Œç‚¹å‡»ä¸‹é¢æŒ‰é’®æµ‹è¯•å›¾ç‰‡æ˜¯å¦èƒ½åŠ è½½ï¼š</p>
        <button onclick="testImages()">æµ‹è¯•å›¾ç‰‡åŠ è½½</button>
        <div id="photoGrid"></div>
    </div>
    
    <div class="test-section">
        <h3>4. JavaScript ç¯å¢ƒæ£€æµ‹</h3>
        <pre id="jsEnv"></pre>
    </div>
    
    <div class="test-section">
        <h3>5. ä¸»é¢˜æµ‹è¯•</h3>
        <button class="theme-btn theme-btn-default" data-theme="default">é»˜è®¤ ğŸ¨</button>
        <button class="theme-btn theme-btn-newyear" data-theme="newyear">æ–°å¹´ ğŸ§§</button>
        <button class="theme-btn theme-btn-birthday" data-theme="birthday">ç”Ÿæ—¥ ğŸ‚</button>
    </div>
    
    <div class="test-section">
        <h3>6. å¿«é€Ÿä¿®å¤</h3>
        <button onclick="window.location.href='/'">è¿”å›ä¸»é¡µ</button>
        <button onclick="location.reload()">åˆ·æ–°è°ƒè¯•é¡µ</button>
        <button onclick="clearCache()">æ¸…é™¤ç¼“å­˜åˆ·æ–°</button>
    </div>

    <script>
        var photos = [];
        
        // æ£€æµ‹ JS ç¯å¢ƒ
        document.getElementById('jsEnv').innerHTML = 
            '<span class="success">âœ“ JavaScript æ­£å¸¸è¿è¡Œ</span>\n' +
            'User Agent: ' + navigator.userAgent + '\n' +
            'URL: ' + window.location.href + '\n' +
            'æ—¶é—´: ' + new Date().toLocaleString();
        
        function testAPI() {
            var result = document.getElementById('apiResult');
            result.innerHTML = 'æ­£åœ¨è¯·æ±‚...';
            
            fetch('/api/photos')
                .then(function(response) {
                    result.innerHTML = '<span class="success">âœ“ HTTP ' + response.status + '</span>\n';
                    result.innerHTML += 'Content-Type: ' + response.headers.get('Content-Type') + '\n';
                    return response.text();
                })
                .then(function(text) {
                    result.innerHTML += '\nåŸå§‹å“åº”:\n' + text;
                    try {
                        var json = JSON.parse(text);
                        result.innerHTML += '\n\n<span class="success">âœ“ JSON è§£ææˆåŠŸ</span>';
                        result.innerHTML += '\nsuccess: ' + json.success;
                        result.innerHTML += '\nphotos æ•°é‡: ' + (json.photos ? json.photos.length : 'undefined');
                    } catch (e) {
                        result.innerHTML += '\n\n<span class="error">âœ— JSON è§£æå¤±è´¥: ' + e.message + '</span>';
                    }
                })
                .catch(function(error) {
                    result.innerHTML = '<span class="error">âœ— è¯·æ±‚å¤±è´¥: ' + error.message + '</span>';
                });
        }
        
        function loadPhotoList() {
            var result = document.getElementById('photoList');
            result.innerHTML = 'æ­£åœ¨åŠ è½½...';
            
            fetch('/api/photos')
                .then(function(response) { return response.json(); })
                .then(function(data) {
                    if (data.success && data.photos) {
                        photos = data.photos;
                        if (photos.length === 0) {
                            result.innerHTML = '<span class="warning">âš  ç…§ç‰‡åˆ—è¡¨ä¸ºç©ºï¼ˆæ²¡æœ‰ç…§ç‰‡ï¼‰</span>';
                        } else {
                            var html = '<span class="success">âœ“ æ‰¾åˆ° ' + photos.length + ' å¼ ç…§ç‰‡</span>\n\n';
                            photos.forEach(function(p, i) {
                                html += (i + 1) + '. ' + p.filename + '\n';
                                html += '   URL: ' + p.url + '\n';
                                html += '   ID: ' + p.id + '\n\n';
                            });
                            result.innerHTML = html;
                        }
                    } else {
                        result.innerHTML = '<span class="error">âœ— API è¿”å›å¤±è´¥</span>\n' + JSON.stringify(data);
                    }
                })
                .catch(function(error) {
                    result.innerHTML = '<span class="error">âœ— åŠ è½½å¤±è´¥: ' + error.message + '</span>';
                });
        }
        
        function testImages() {
            var grid = document.getElementById('photoGrid');
            grid.innerHTML = '';
            
            if (photos.length === 0) {
                grid.innerHTML = '<span class="warning">âš  è¯·å…ˆç‚¹å‡»"åŠ è½½ç…§ç‰‡åˆ—è¡¨"</span>';
                return;
            }
            
            photos.forEach(function(photo, i) {
                var img = document.createElement('img');
                img.className = 'test-img';
                img.alt = photo.filename;
                img.onload = function() {
                    this.style.borderColor = '#2ecc71';
                    console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ:', photo.url);
                };
                img.onerror = function() {
                    this.style.borderColor = '#e74c3c';
                    this.alt = 'åŠ è½½å¤±è´¥: ' + photo.url;
                    console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', photo.url);
                };
                img.src = photo.url;
                grid.appendChild(img);
            });
        }
        
        function clearCache() {
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    names.forEach(function(name) {
                        caches.delete(name);
                    });
                });
            }
            location.reload(true);
        }
    </script>
    <script src="{{ url_for('static', filename='theme-controller.js') }}"></script>
</body>
</html>

